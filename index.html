<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>iPA Groove</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="background.css">
  <link rel="stylesheet" href="navigation.css">
  <link rel="stylesheet" href="sections.css">
  <link rel="stylesheet" href="games.css">
  <link rel="stylesheet" href="apps.css">
  <link rel="stylesheet" href="menu.css">
  <link rel="stylesheet" href="mail.css">
  <link rel="stylesheet" href="auth.css">
</head>
<body>

  <video class="video-bg" autoplay muted loop playsinline>
    <source src="https://raw.githubusercontent.com/iPAGroove/Innovation/main/videos/%D0%A4%D0%BE%D0%BD.mp4" type="video/mp4">
    <source src="https://raw.githubusercontent.com/iPAGroove/Innovation/main/videos/background1.webm" type="video/webm">
  </video>

  <!-- GAMES -->
  <div class="screen" id="gamesScreen">
    <div class="search-bar">
      <input type="search" placeholder="Search games..." />
    </div>
    <div class="category-section"><h2 class="section-title">VIP</h2><div class="horizontal-scroll" id="games-vip"></div></div>
    <div class="category-section"><h2 class="section-title">FREE</h2><div class="horizontal-scroll" id="games-free"></div></div>
    <div class="category-section"><h2 class="section-title">UPDATES</h2><div class="horizontal-scroll" id="games-updates"></div></div>
    <div class="category-section"><h2 class="section-title">TOP</h2><div class="horizontal-scroll" id="games-top"></div></div>
  </div>

  <!-- APPS -->
  <div class="screen" id="appsScreen">
    <div class="search-bar">
      <input type="search" placeholder="Search apps..." />
    </div>
    <div class="category-section"><h2 class="section-title">VIP</h2><div class="horizontal-scroll" id="apps-vip"></div></div>
    <div class="category-section"><h2 class="section-title">FREE</h2><div class="horizontal-scroll" id="apps-free"></div></div>
    <div class="category-section"><h2 class="section-title">UPDATES</h2><div class="horizontal-scroll" id="apps-updates"></div></div>
    <div class="category-section"><h2 class="section-title">TOP</h2><div class="horizontal-scroll" id="apps-top"></div></div>
  </div>

  <!-- MENU -->
  <div id="menuPanel" class="menu-panel">
    <div class="menu-content">
      <div class="auth-container">
        <div class="auth-tabs">
          <button id="loginTab" class="auth-tab-btn active">Войти</button>
          <button id="registerTab" class="auth-tab-btn">Регистрация</button>
        </div>

        <div id="loginForm" class="auth-form active">
          <input type="email" id="loginEmail" placeholder="Email" autocomplete="email">
          <input type="password" id="loginPassword" placeholder="Пароль" autocomplete="current-password">
          <button id="loginBtn">Войти</button>
          <p id="loginError" class="auth-error"></p>
        </div>

        <div id="registerForm" class="auth-form">
          <input type="email" id="registerEmail" placeholder="Email" autocomplete="email">
          <input type="password" id="registerPassword" placeholder="Пароль" autocomplete="new-password">
          <button id="registerBtn">Зарегистрироваться</button>
          <p id="registerError" class="auth-error"></p>
        </div>

        <div id="userStatus" class="user-status">
          <p id="loggedInUser"></p>
          <button id="logoutBtn" class="logout-btn">Выйти</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIL MODAL -->
  <div id="mailModal" class="mail-modal">
    <div class="mail-content">
      <button class="close-btn" id="closeMail">×</button>
      <h2>Связаться с iPA Groove</h2>
      <p>Окно для формы связи или других элементов почты</p>
    </div>
  </div>

  <!-- NAVIGATION -->
  <nav class="bottom-nav">
    <a href="#" class="nav-item" id="openGames" title="Games">
      <svg viewBox="0 0 24 24" fill="none"><path d="M6 14H4L2 18V20H6L7 18L6 14ZM18 14H20L22 18V20H18L17 18L18 14ZM10 9H14V11H10V9ZM8 7H16V13H8V7Z" fill="white"/></svg>
    </a>
    <a href="#" class="nav-item" id="openApps" title="Apps">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 4H10V10H4V4ZM14 4H20V10H14V4ZM4 14H10V20H4V14ZM14 14H20V20H14V14Z" fill="white"/></svg>
    </a>
    <a href="#" class="nav-item" title="Mail">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 4H20V20H4V4ZM4 4L12 13L20 4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </a>
    <a href="#" class="nav-item" title="Menu">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 6H20M4 12H20M4 18H20" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
    </a>
  </nav>

  <!-- JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB2In0cOmuiYB6zNj0dQrdJ8bwPkINKdzA",
      authDomain: "updaterepoipa.firebaseapp.com",
      projectId: "updaterepoipa",
      storageBucket: "updaterepoipa.firebasestorage.app",
      messagingSenderId: "621595788422",
      appId: "1:621595788422:web:180163c46b349232243d07",
      measurementId: "G-T42CG13QPR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    getAnalytics(app);

    async function loadCollection(collName, prefix) {
      const querySnapshot = await getDocs(collection(db, collName));
      const containers = {
        vip: document.getElementById(`${prefix}-vip`),
        free: document.getElementById(`${prefix}-free`),
        updates: document.getElementById(`${prefix}-updates`),
        top: document.getElementById(`${prefix}-top`),
      };
      querySnapshot.forEach(doc => {
        const d = doc.data();
        if (containers[d.type]) containers[d.type].innerHTML += `
          <div class="icon-card">
            <img src="${d.icon}" alt="${d.title}">
            <span>${d.title}</span>
          </div>`;
      });
    }

    await loadCollection('games', 'games');
    await loadCollection('apps', 'apps');

    // ---------------------- AUTH ----------------------
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const userStatus = document.getElementById('userStatus');
    const loggedInUser = document.getElementById('loggedInUser');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginEmailInput = document.getElementById('loginEmail');
    const loginPasswordInput = document.getElementById('loginPassword');
    const loginBtn = document.getElementById('loginBtn');
    const loginError = document.getElementById('loginError');
    const registerEmailInput = document.getElementById('registerEmail');
    const registerPasswordInput = document.getElementById('registerPassword');
    const registerBtn = document.getElementById('registerBtn');
    const registerError = document.getElementById('registerError');

    loginForm.classList.add('active');
    registerForm.classList.remove('active');
    userStatus.style.display = 'none';

    loginTab.addEventListener('click', () => {
      loginForm.classList.add('active');
      registerForm.classList.remove('active');
      loginTab.classList.add('active');
      registerTab.classList.remove('active');
      loginError.textContent = '';
      registerError.textContent = '';
    });

    registerTab.addEventListener('click', () => {
      registerForm.classList.add('active');
      loginForm.classList.remove('active');
      registerTab.classList.add('active');
      loginTab.classList.remove('active');
      loginError.textContent = '';
      registerError.textContent = '';
    });

    loginBtn.addEventListener('click', async () => {
      const email = loginEmailInput.value;
      const password = loginPasswordInput.value;
      loginError.textContent = '';
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        let msg = 'Ошибка входа.';
        if (error.code === 'auth/invalid-email') msg = 'Некорректный email.';
        else if (error.code === 'auth/user-disabled') msg = 'Пользователь отключен.';
        else if (['auth/user-not-found', 'auth/wrong-password'].includes(error.code)) msg = 'Неправильный email или пароль.';
        loginError.textContent = msg;
      }
    });

    registerBtn.addEventListener('click', async () => {
      const email = registerEmailInput.value;
      const password = registerPasswordInput.value;
      registerError.textContent = '';
      try {
        await createUserWithEmailAndPassword(auth, email, password);
      } catch (error) {
        let msg = 'Ошибка регистрации.';
        if (error.code === 'auth/email-already-in-use') msg = 'Email уже используется.';
        else if (error.code === 'auth/invalid-email') msg = 'Некорректный email.';
        else if (error.code === 'auth/weak-password') msg = 'Пароль слишком простой.';
        registerError.textContent = msg;
      }
    });

    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
      } catch (error) {
        console.error('Ошибка выхода:', error.message);
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        loggedInUser.textContent = `Вы вошли как: ${user.email}`;
        userStatus.style.display = 'block';
        loginForm.style.display = 'none';
        registerForm.style.display = 'none';
        loginTab.style.display = 'none';
        registerTab.style.display = 'none';
      } else {
        loggedInUser.textContent = '';
        userStatus.style.display = 'none';
        loginForm.style.display = 'flex';
        registerForm.style.display = 'none';
        loginTab.style.display = 'block';
        registerTab.style.display = 'block';
        loginTab.classList.add('active');
        registerTab.classList.remove('active');
      }
    });
  </script>

  <script src="script.js"></script>
  <script src="menu.js"></script>
  <script src="mail.js"></script>
</body>
</html>
